<script>
        // PASTIKAN URL INI ADALAH URL DEPLOYMENT ANDA
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwhgQUNPqCEDCUdFjn0wGryeZEBnNPEsqn9UaJtpYwKkczWUeKiDJ3lkLtdH2XcXioE/exec'; 

        const form = document.forms['voucherForm'];
        const btn = document.getElementById('submitBtn');
        const msgDiv = document.getElementById('message');

        form.addEventListener('submit', async e => {
            e.preventDefault();
            
            // UI Loading
            btn.disabled = true;
            btn.innerHTML = 'Sedang Memproses...';
            msgDiv.style.display = 'none';

            try {
                // 1. Ambil IP Address User (Pakai layanan pihak ketiga gratis ipify)
                let userIP = "Unknown";
                try {
                    const ipReq = await fetch('https://api.ipify.org?format=json');
                    const ipRes = await ipReq.json();
                    userIP = ipRes.ip;
                } catch (err) {
                    console.warn("Gagal mengambil IP", err);
                }

                // 2. Deteksi System / User Agent
                const userSystem = navigator.userAgent; 

                // 3. Gabungkan data Form + System Info
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                // Tambahkan data teknis ke object data
                data.ip = userIP;
                data.system = userSystem;

                // 4. Kirim ke Google Script
                const response = await fetch(scriptURL, { 
                    method: 'POST', 
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();

                // 5. Handle Response
                btn.disabled = false;
                btn.innerHTML = 'Submit';

                if(result.result === 'success') {
                    form.reset();
                    msgDiv.innerHTML = '✅ ' + result.message;
                    msgDiv.style.color = '#90ff90';
                } else {
                    msgDiv.innerHTML = '❌ ' + result.message;
                    msgDiv.style.color = '#ff9090';
                }
                msgDiv.style.display = 'block';

            } catch (error) {
                btn.disabled = false;
                btn.innerHTML = 'Submit';
                msgDiv.innerHTML = '❌ Terjadi kesalahan jaringan!';
                msgDiv.style.color = '#ff9090';
                msgDiv.style.display = 'block';
                console.error('Error!', error);
            }
        });
    </script>
